<%intent=Stripe::PaymentIntent.create(
  amount: Price.find(params[:id]).unit_amount*100,
  currency: 'usd',
  payment_method_types: [
    #'bancontact',
    'card',
    #'eps',
    #'giropay',
    #'ideal',
    #'p24',
    #'sepa_debit',
    #'sofort',
    
  ],
)%>
<html lang="en">
  <head>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
  </head>
  <body>
    <div class = "Payment new">
      <h1> Stripe Payment </h1>
      
      <%=form_for(@payment, :url => payments_path(:id=>params[:id]), :html => {:id => "payment-form"}) do |f| %>
        Name:
        <%=f.text_field(:name)%>
        <br / ><br / >
        Email:
        <%=f.text_field(:email)%>
        <br / ><br / >
        Country:
        <%=f.text_field(:country)%>
        <br / ><br / >
        <div id="card-element">
        <!-- Elements will create form elements here -->
        </div>
        <div id="card-errors", role="alert">
        <!-- Elements will create form elements here -->
        </div>
        <br / ><br / >
        Postal Code:
        <div id="postal-code">
          <%=f.text_field(:country)%>
        <!-- Elements will create form elements here -->
        </div>
        
        <div>
          <%=f.submit("Confirm")%>
        </div>
        
      <%end%>
    </div>
    
    <script type="text/javascript">

    /*const options = {
      clientSecret: "pi_3Jzgv9Gx183h7tz10SRviCyY_secret_hhyoewmmiLQsbSUp2AMiEsu9k"
    };*/
      var stripe=Stripe('pk_test_51Jw29PGx183h7tz1vCKbiozJIc5B8Zjx1aFAKed2v1Kb25Vshxt4PIWXHHLlhCL7d6vkVL60i1Xbuv5ncGbNoXaK00vBB66Zf7');
      var elements=stripe.elements();/*(options);*/
      var style = {
      base: {
        color: "#32325d",
      }
    };

    /*var cardNumberElement = document.getElementById("card-element");
    var tempPostalCode=document.getElementById("postal-code");
    const paymentElement = elements.create('payment'); 
    const postalCode=elements.create('postalCode');
    paymentElement.mount("#card-element");*/  /* we can also write "#card-element" instead of cardNumberElement.. because card-element is in form <div id="card-element">
        </div>... payment intent must be created before creating payment element like elements.create('payment').. and pass payment intent
        to clientsecret like->.. const options = {
      clientSecret: "pi_3Jzgv9Gx183h7tz10SRviCyY_secret_hhyoewmmiLQsbSUp2AMiEsu9k"
    }; */ 
    /*postalCode.mount(tempPostalCode)*/
    var cardElement=elements.create('card');
    cardElement.mount('#card-element');

    cardElement.addEventListener('change', ({error})=>{
    const displayError = document.getElementById('card-errors');
      if (error) {
        displayError.textContent = error.message;
      } else {
        displayError.textContent = '';
      }
    });

  var form = document.getElementById('payment-form');
  form.addEventListener('submit', function(ev) {
    ev.preventDefault();
    stripe.confirmCardPayment('<%=intent.client_secret;%>', {
      payment_method: {
        card: cardElement,
        billing_details: {
          name: 'Komal Abid'
        }
      }
    }).then(function(result) {
      if (result.error) {
        // Show error to your customer (e.g., insufficient funds)
        console.log(result.error.message);
        $('#card-errors').text(result.error.message);
      } else {
        // The payment has been processed!
        if (result.paymentIntent.status === 'succeeded') {
          
          // Show a success message to your customer
          // There's a risk of the customer closing the window before callback
          // execution. Set up a webhook or plugin to listen for the
          // payment_intent.succeeded event that handles any business critical
          // post-payment actions.

            console.log(result);
                

          $('#card-errors').text('Payment Completed');

        }
      }
    });
});


  </script>
  </body>
  
</html>